<div class="expression-node" [class.root]="isRoot">
  <ng-template #variableTemplate>
    <span class="variable" [class.selected]="node.selected" (click)="onNodeClick($event)">
        <ng-container *ngIf="!showInput; else inputTemplate">{{ node.display }}</ng-container>
        <ng-template #inputTemplate [ngSwitch]="node.canInput">
            <nz-input-number *ngSwitchCase="'number'" [(ngModel)]="node.display" [nzMin]="0" [nzMax]="10" [nzStep]="1" [nzPrecision]="0" (keyup.enter)="nodeValueChange()" (nzBlur)="nodeValueChange()" nzPlaceHolder="请输入" nzSize="small"></nz-input-number>
            <input *ngSwitchDefault [(ngModel)]="node.display" (keyup.enter)="nodeValueChange()" (blur)="nodeValueChange()" nz-input placeholder="请输入" nzSize="small" />
        </ng-template>
    </span>
    <button *ngIf="node.canInput" class="change" nz-button nzShape="circle" nzSize="small" (click)="showInputChange()">
      <svg width="16" height="16.0001220703125" viewBox="0 0 16 16.0001220703125"><defs><clipPath id="master_svg0_2_374877/2_46305/2_33595"><rect x="0" y="0" width="16" height="16.0001220703125" rx="0"/></clipPath></defs><g clip-path="url(#master_svg0_2_374877/2_46305/2_33595)"><g><path d="M11.838670356445313,6.879457954101563C11.643410356445312,7.074717954101563,11.326830356445312,7.074717954101563,11.131570356445312,6.879457954101563C10.936300356445312,6.684187954101563,10.936300356445312,6.367607954101563,11.131570356445312,6.1723479541015625L12.293790356445312,5.010087954101563L3.5246203564453125,5.010087954101563C3.248480356445312,5.010087954101563,3.0246203564453125,5.233947954101563,3.0246203564453125,5.510087954101563L3.0246203564453125,6.995177954101562C3.0246203564453125,7.271317954101563,2.8007643564453124,7.495177954101562,2.5246223564453123,7.495177954101562C2.2484793564453125,7.495177954101562,2.0246219634453126,7.271317954101563,2.0246219634453126,6.995177954101562L2.0246219634453126,5.510087954101563C2.0246219634453126,4.681657954101563,2.6961943564453126,4.010087954101563,3.5246203564453125,4.010087954101563L12.293990356445313,4.010087954101563L11.131570356445312,2.8478309541015623C10.958000356445313,2.6742639541015625,10.938710356445313,2.4048399541015626,11.073710356445313,2.2099719541015626L11.131570356445312,2.1407239541015626C11.326830356445312,1.9454617541015624,11.643410356445312,1.9454617541015624,11.838670356445313,2.1407239541015626L13.854490356445313,4.156537954101562C14.049790356445312,4.351797954101563,14.049790356445312,4.668377954101563,13.854490356445313,4.863637954101563L11.838670356445313,6.879457954101563ZM13.500990356445312,8.528787954101563C13.777090356445312,8.528787954101563,14.000990356445312,8.752647954101562,14.000990356445312,9.028787954101563L14.000990356445312,10.512697954101563C14.000990356445312,11.341127954101562,13.329390356445312,12.012677954101562,12.500990356445312,12.012677954101562L3.7312703564453127,12.012677954101562L4.893730356445312,13.174977954101562C5.067300356445312,13.348477954101563,5.086580356445312,13.617977954101562,4.951590356445312,13.812777954101563L4.893730356445312,13.882077954101563C4.698470356445313,14.077277954101563,4.381890356445313,14.077277954101563,4.1866303564453125,13.882077954101563L2.1708153564453125,11.866257954101563C1.9755527564453126,11.670987954101562,1.9755527564453126,11.354407954101562,2.1708153564453125,11.159147954101563L4.1866303564453125,9.143337954101563C4.381890356445313,8.948077954101564,4.698470356445313,8.948077954101564,4.893730356445312,9.143337954101563C5.088990356445312,9.338597954101562,5.088990356445312,9.655177954101562,4.893730356445312,9.850437954101562L3.7315303564453126,11.012697954101563L12.500990356445312,11.012697954101563C12.777090356445312,11.012697954101563,13.000990356445312,10.788837954101563,13.000990356445312,10.512697954101563L13.000990356445312,9.028787954101563C13.000990356445312,8.752647954101562,13.224790356445313,8.528787954101563,13.500990356445312,8.528787954101563Z" fill-rule="evenodd" fill-opacity="1"/></g></g></svg>
    </button>
  </ng-template>

  <ng-container *ngIf="node.type === 'operator'; else variableTemplate">
    <span class="operator" [class.selected]="node.selected">
      <ng-container *ngFor="let child of node.children; let i = index">
        <app-expression-item *ngIf="child?.value; else displayTemplate"
          [node]="child"
          (nodeSelected)="nodeSelected.emit($event)"
          (nodeChange)="nodeChange.emit($event)"
          (nodeDelete)="nodeDelete.emit($event)">
        </app-expression-item>
        <ng-template #displayTemplate>
            <span *ngIf="!child.displayOptions" class="operator-symbol" (click)="onNodeClick($event)">{{ child.display }}</span>
            <nz-select *ngIf="child.displayOptions" class="operator-select" nzSize="small" [(ngModel)]="child.display">
              <nz-option *ngFor="let option of child.displayOptions" [nzLabel]="option" [nzValue]="option"></nz-option>
            </nz-select>
        </ng-template>
        <button *ngIf="child.canDelete" nz-button nzShape="circle" nzSize="small" (click)="handleDelete(i)"> - </button>
        <ng-container *ngIf="child.canAdd">
            <button nz-button nzShape="circle" nzSize="small" (click)="handleAdd(i)"> + </button>
            <br *ngIf="node.addValue.length > 3">
        </ng-container>
      </ng-container>
    </span>
  </ng-container>
</div>
