<nz-modal *ngIf="isVisible" [nzVisible]="true" [nzTitle]="(!isEdit ? '新增' : canOperate ? '编辑' : '') + '关联关系'" nzWidth="960px" (nzOnCancel)="close()" (nzOnOk)="handleOk()" [nzOkDisabled]="okDisabled">
    <ng-container *nzModalContent>
        <div class="form-item">
            <label>关联方式：</label>
            <nz-radio-group [(ngModel)]="mode">
                <label *ngIf="false" nz-radio nzValue="inner">内关联</label>
                <label nz-radio nzValue="right">左关联</label>
            </nz-radio-group>
        </div>
        <div class="config-table">
            <div class="table-thead">
                <div>主关联字段</div>
                <div>{{ node?.domainObjectName }}</div>
                <div>
                    <nz-input-group *ngIf="!this.isEdit; else targetName" (click)="selectTargetObject()" [nzSuffix]="arrowIcon">
                        <input nz-input placeholder="目标领域对象" [value]="targetObject?.domainObjectName" disabled />
                    </nz-input-group>
                    <ng-template #arrowIcon>
                        <svg width="16" height="16" viewBox="0 0 16 16">
                            <g><g><path d="M12,2C13.1046,2,14,2.895431,14,4L14,12C14,13.1046,13.1046,14,12,14L4,14C2.895431,14,2,13.1046,2,12L2,4C2,2.895431,2.895431,2,4,2L12,2ZM12,3L4,3C3.44772,3,3,3.44772,3,4L3,12C3,12.5523,3.44772,13,4,13L12,13C12.5523,13,13,12.5523,13,12L13,4C13,3.44772,12.5523,3,12,3ZM7.44416,4.6541999999999994C7.2489,4.45894,6.93232,4.45894,6.73705,4.6541999999999994L6.6792,4.72345C6.5442,4.91831,6.56349,5.18774,6.73705,5.3613L9.383610000000001,8.00775L6.73705,10.6542C6.54179,10.84946,6.54179,11.16604,6.73705,11.36131C6.93232,11.55657,7.2489,11.55657,7.44416,11.36131L10.44416,8.3613C10.63942,8.166039999999999,10.63942,7.84946,10.44416,7.6542L7.44416,4.6541999999999994Z" fill="#A6A6B2" fill-opacity="1" /></g></g>
                        </svg>
                    </ng-template>
                    <ng-template #targetName>{{ targetObject?.domainObjectName }}</ng-template>
                </div>
                <div *ngIf="canOperate" class="operate">操作</div>
            </div>
            <div class="table-tbody" *ngIf="!!relations.length">
                <div *ngFor="let relation of relations; let i = index;">
                    <div class="center">
                        <nz-switch [disabled]="!canOperate" [(ngModel)]="relation.mainField" (ngModelChange)="changeMainField(relation, $event)" nzCheckedChildren="是" nzUnCheckedChildren="否"></nz-switch>
                    </div>
                    <div>
                        <nz-select *ngIf="canOperate && relation.leftCode !== 'tenantsid'; else leftName" nzShowSearch [nzFilterOption]="filterOption" [(ngModel)]="relation.leftCode" (ngModelChange)="changeFieldCode(relation, $event)" nzPlaceHolder="请选择" nzAllowClear>
                            <nz-option *ngFor="let option of leftOptions;" [nzValue]="option.fieldCode" [nzLabel]="option?.fieldName" [nzDisabled]="getOptionsDisabled(option.fieldCode, 'leftCode')"></nz-option>
                        </nz-select>
                        <ng-template #leftName>{{ relation.leftName }}</ng-template>
                    </div>
                    <div class="center td-right">
                        <i class="link">
                            <svg width="16" height="16" viewBox="0 0 16 16"><g><g transform="matrix(0.7071067690849304,0.7071067690849304,-0.7071067690849304,0.7071067690849304,3.1212999419203697,-7.0918807220023155)"><path d="M17.121307373046875,4.2218017578125L17.121307373046875,5.7218017578125C17.121307373046875,5.9979417578125,17.345167373046877,6.2218017578125,17.621307373046875,6.2218017578125C17.897447373046873,6.2218017578125,18.121307373046875,5.9979417578125,18.121307373046875,5.7208217578125L18.121307373046875,4.2218017578125Q18.121307373046875,2.5649417578125,16.949737373046876,1.3933717578125Q15.778157373046875,0.2218017578125,14.121307373046875,0.2218017578125Q12.464457373046875,0.2218017578125,11.292877373046874,1.3933717578125Q10.121307373046875,2.5649517578125,10.121307373046875,4.2218017578125L10.121307373046875,5.7218017578125C10.121307373046875,5.9979417578125,10.345165373046875,6.2218017578125,10.621307373046875,6.2218017578125C10.897450373046874,6.2218017578125,11.121307373046875,5.9979417578125,11.121307373046875,5.7218017578125L11.121307373046875,4.2218017578125Q11.121307373046875,2.9791617578125,11.999987373046874,2.1004817578125Q12.878667373046875,1.2218017578125,14.121307373046875,1.2218017578125Q15.363947373046875,1.2218017578125,16.242627373046876,2.1004817578125Q17.121307373046875,2.9791617578125,17.121307373046875,4.2218017578125ZM14.621307373046875,10.2218017578125L14.621307373046875,4.2218017578125C14.621307373046875,3.9456617578125,14.397447373046875,3.7218017578125,14.121307373046875,3.7218017578125C13.845167373046875,3.7218017578125,13.621307373046875,3.9456617578125,13.621307373046875,4.2218017578125L13.621307373046875,10.2218017578125C13.621307373046875,10.4979017578125,13.845167373046875,10.7218017578125,14.121307373046875,10.7218017578125C14.397447373046875,10.7218017578125,14.621307373046875,10.4979017578125,14.621307373046875,10.2218017578125ZM10.121307373046875,8.7218017578125C10.121307373046875,8.4456617578125,10.345165373046875,8.2218017578125,10.621307373046875,8.2218017578125C10.897450373046874,8.2218017578125,11.121307373046875,8.4456617578125,11.121307373046875,8.7218017578125L11.121307373046875,10.2218017578125Q11.121307373046875,11.4644017578125,11.999987373046874,12.3431017578125Q12.878667373046875,13.2218017578125,14.121307373046875,13.2218017578125Q15.363947373046875,13.2218017578125,16.242627373046876,12.3431017578125Q17.121307373046875,11.4644017578125,17.121307373046875,10.2218017578125L17.121307373046875,8.7218017578125C17.121307373046875,8.4456617578125,17.345167373046877,8.2218017578125,17.621307373046875,8.2218017578125C17.897447373046873,8.2218017578125,18.121307373046875,8.4456617578125,18.121307373046875,8.7227817578125L18.121307373046875,10.2218017578125Q18.121307373046875,11.8787017578125,16.949737373046876,13.0502017578125Q15.778167373046875,14.2218017578125,14.121307373046875,14.2218017578125Q12.464447373046875,14.2218017578125,11.292877373046874,13.0502017578125Q10.121307373046875,11.8787017578125,10.121307373046875,10.2218017578125L10.121307373046875,8.7218017578125Z" fill-rule="evenodd" fill="#8C8B99" fill-opacity="1"/></g></g></svg>
                        </i>
                        <nz-form-control [nzValidateStatus]="relation.error ? 'error' : ''" nzErrorTip="字段类型需一致">
                            <nz-input-group *ngIf="canOperate && relation.rightCode !== 'tenantsid'; else rightName" [class.error]="relation.error" [ngSwitch]="relation.rightType" [nzAddOnBefore]="changeTypeTpl" [class.disabled]="!targetObject?.domainObjectCode">
                                <input *ngSwitchCase="FieldTypeEnum.CONST" [(ngModel)]="relation.rightName" (ngModelChange)="changeRightCode(relation, $event)" [disabled]="!targetObject?.domainObjectCode" nz-input placeholder="请输入" />
                                <nz-select *ngSwitchDefault nzShowSearch [nzFilterOption]="filterOption" (ngModelChange)="changeRightCode(relation, $event)" [(ngModel)]="relation.rightCode" [disabled]="!targetObject?.domainObjectCode" nzPlaceHolder="请选择" nzAllowClear>
                                    <nz-option *ngFor="let option of rightOptions;" [nzValue]="option.fieldCode" [nzLabel]="option?.fieldName" [nzDisabled]="getOptionsDisabled(option.fieldCode, 'rightCode')"></nz-option>
                                </nz-select>
                            </nz-input-group>
                        </nz-form-control>
                        <ng-template #changeTypeTpl>
                            <div (click)="changeRightType(relation, relation.rightType === FieldTypeEnum.FIELD ? FieldTypeEnum.CONST :  FieldTypeEnum.FIELD)">
                                {{ relation.rightType === FieldTypeEnum.CONST ? '常量' : '字段' }}
                                <i class="change" nz-icon>
                                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" version="1.1" width="16" height="16.0001220703125" viewBox="0 0 16 16.0001220703125"><defs><clipPath id="master_svg0_2_374877/2_46305/2_33595"><rect x="0" y="0" width="16" height="16.0001220703125" rx="0"/></clipPath></defs><g clip-path="url(#master_svg0_2_374877/2_46305/2_33595)"><g><path d="M11.838670356445313,6.879457954101563C11.643410356445312,7.074717954101563,11.326830356445312,7.074717954101563,11.131570356445312,6.879457954101563C10.936300356445312,6.684187954101563,10.936300356445312,6.367607954101563,11.131570356445312,6.1723479541015625L12.293790356445312,5.010087954101563L3.5246203564453125,5.010087954101563C3.248480356445312,5.010087954101563,3.0246203564453125,5.233947954101563,3.0246203564453125,5.510087954101563L3.0246203564453125,6.995177954101562C3.0246203564453125,7.271317954101563,2.8007643564453124,7.495177954101562,2.5246223564453123,7.495177954101562C2.2484793564453125,7.495177954101562,2.0246219634453126,7.271317954101563,2.0246219634453126,6.995177954101562L2.0246219634453126,5.510087954101563C2.0246219634453126,4.681657954101563,2.6961943564453126,4.010087954101563,3.5246203564453125,4.010087954101563L12.293990356445313,4.010087954101563L11.131570356445312,2.8478309541015623C10.958000356445313,2.6742639541015625,10.938710356445313,2.4048399541015626,11.073710356445313,2.2099719541015626L11.131570356445312,2.1407239541015626C11.326830356445312,1.9454617541015624,11.643410356445312,1.9454617541015624,11.838670356445313,2.1407239541015626L13.854490356445313,4.156537954101562C14.049790356445312,4.351797954101563,14.049790356445312,4.668377954101563,13.854490356445313,4.863637954101563L11.838670356445313,6.879457954101563ZM13.500990356445312,8.528787954101563C13.777090356445312,8.528787954101563,14.000990356445312,8.752647954101562,14.000990356445312,9.028787954101563L14.000990356445312,10.512697954101563C14.000990356445312,11.341127954101562,13.329390356445312,12.012677954101562,12.500990356445312,12.012677954101562L3.7312703564453127,12.012677954101562L4.893730356445312,13.174977954101562C5.067300356445312,13.348477954101563,5.086580356445312,13.617977954101562,4.951590356445312,13.812777954101563L4.893730356445312,13.882077954101563C4.698470356445313,14.077277954101563,4.381890356445313,14.077277954101563,4.1866303564453125,13.882077954101563L2.1708153564453125,11.866257954101563C1.9755527564453126,11.670987954101562,1.9755527564453126,11.354407954101562,2.1708153564453125,11.159147954101563L4.1866303564453125,9.143337954101563C4.381890356445313,8.948077954101564,4.698470356445313,8.948077954101564,4.893730356445312,9.143337954101563C5.088990356445312,9.338597954101562,5.088990356445312,9.655177954101562,4.893730356445312,9.850437954101562L3.7315303564453126,11.012697954101563L12.500990356445312,11.012697954101563C12.777090356445312,11.012697954101563,13.000990356445312,10.788837954101563,13.000990356445312,10.512697954101563L13.000990356445312,9.028787954101563C13.000990356445312,8.752647954101562,13.224790356445313,8.528787954101563,13.500990356445312,8.528787954101563Z" fill-rule="evenodd" fill="#A6A6B2" fill-opacity="1"/></g></g></svg>
                                </i>
                            </div>
                        </ng-template>
                        <ng-template #rightName>{{ relation.rightName }}</ng-template>
                    </div>
                    <div *ngIf="canOperate" class="center operate">
                        <i *ngIf="relation.rightCode !== 'tenantsid'"
                           class="delete"
                           nz-icon
                           nz-popconfirm
                           nzPopconfirmTitle="是否确认删除？"
                           nzOkText="删除"
                           [nzOkDanger]="true"
                           (nzOnConfirm)="handleDelete(i)"
                        >
                            <svg width="16" height="16" viewBox="0 0 16 16"><g><g><path d="M13.5,4L11,4C11,3.94626,10.99134,3.8928700000000003,10.97434,3.8418900000000002L10.47434,2.341886C10.40628,2.137715,10.21522,2.0000000298023,10,2L6,2C5.78478,2,5.593719999999999,2.137715,5.52566,2.341886L5.0258199999999995,3.8414099999999998L5.0258199999999995,3.8414099999999998C5.00866,3.8928700000000003,5,3.94626,5,4L2.5,4C2.223858,4,2,4.22386,2,4.5C2,4.77614,2.223858,5,2.5,5L3.5,5L3.5,12.5Q3.5,13.1213,3.93934,13.5607Q4.37868,14,5,14L11,14Q11.62132,14,12.0607,13.5607Q12.5,13.1213,12.5,12.5L12.5,5L13.5,5C13.7761,5,14,4.77614,14,4.5C14,4.22386,13.7761,4,13.5,4ZM9.63962,3L9.97295,4L6.02705,4L6.36038,3L9.63962,3ZM4.5,12.5L4.5,5L11.5,5L11.5,12.5Q11.5,13,11,13L5,13Q4.5,13,4.5,12.5ZM7,6C6.72386,6,6.5,6.22386,6.5,6.5L6.5,11C6.5,11.27614,6.72386,11.5,7,11.5C7.27614,11.5,7.5,11.27614,7.5,11L7.5,6.5C7.5,6.22386,7.27614,6,7,6ZM9,6C8.72386,6,8.5,6.22386,8.5,6.5L8.5,11C8.5,11.27614,8.72386,11.5,9,11.5C9.27614,11.5,9.5,11.27614,9.5,11L9.5,6.5C9.5,6.22386,9.27614,6,9,6Z" fill-rule="evenodd"/></g></g></svg>
                        </i>
                    </div>
                </div>
            </div>
            <button *ngIf="canOperate && relations.length < 10" (click)="handleAdd()" nz-button nzType="dashed">
                <i nz-icon>
                    <svg width="16" height="16" viewBox="0 0 16 16"><g><g><path d="M8,2C7.72386,2,7.5,2.223858,7.5,2.5L7.5,7.5L2.5,7.5C2.223858,7.5,2,7.72386,2,8C2,8.27614,2.223858,8.5,2.5,8.5L7.5,8.5L7.5,13.5C7.5,13.7761,7.72386,14,8,14C8.27614,14,8.5,13.7761,8.5,13.5L8.5,8.5L13.5,8.5C13.7761,8.5,14,8.27614,14,8C14,7.72386,13.7761,7.5,13.5,7.5L8.5,7.5L8.5,2.5C8.5,2.223858,8.27614,2,8,2Z"/></g></g></svg>
                </i>新增关联关系
            </button>
        </div>
    </ng-container>
    <app-canvas-select-domain-object (selectChange)="onTargetObjectChange($event)"></app-canvas-select-domain-object>
</nz-modal>